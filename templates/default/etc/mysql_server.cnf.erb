###
# Generated by Chef for [<%= node[:fqdn] %>]
# Environment: <%= node.chef_environment %>
###

#-----------------------#
[client]
port = <%= @port %>
socket = <%= @socket %>
default-character-set = utf8

#-----------------------#
[mysqld_safe]
socket = <%= @socket %>
nice = <%= @nice %>
open_files_limit = <%= @open_files_limit %>

#-----------------------#
[mysql]
prompt = "{<%= @name %>} [<%= node['hostname'] %>] (\d) > "

#-----------------------#
[server]
#--- base ---#
report-host = <%= @report_host %>
server-id = <%= @server_id %>
<% unless @gtid_domain_id.nil? %>gtid-domain-id = <%= @gtid_domain_id %><% end %>
open_files_limit = <%= @open_files_limit %>
user = mysql
character-set-server = utf8
pid-file = <%= @pid %>
basedir = <%= @basedir %>
datadir = <%= @datadir %>
skip-external-locking
<% unless @skip_name_resolv.nil? %>skip-name-resolve<% end %>
<% unless @event_scheduler.empty? %>event_scheduler = <%= @event_scheduler %><% end %>
read-only = <%= @read_only %>

<% unless @explicit_defaults_for_timestamp.nil? %>explicit_defaults_for_timestamp = TRUE<% end %>

#--- engine ---#
default_storage_engine = <%= @default_storage_engine %>

#--- temp ---#
tmpdir = <%= @tmpdir %>
slave_load_tmpdir = <%= @slave_load_tmpdir %>
tmp_table_size = <%= @tmp_table_size %>
max_heap_table_size = <%= @max_heap_table_size %>

#--- innodb ---#
<% unless @innodb_file_format.empty? %>innodb_file_format = <%= @innodb_file_format %><% end %>
innodb_buffer_pool_size = <%= @innodb_buffer_pool_size %>
innodb_open_files = <%= @innodb_open_files %>
innodb_log_file_size = <%= @innodb_log_file_size %>
innodb_log_buffer_size = <%= @innodb_log_buffer_size %>
innodb_flush_method = <%= @innodb_flush_method %>
innodb_autoextend_increment = <%= @innodb_autoextend_increment %>
innodb_file_io_threads = <%= @innodb_file_io_threads %>
innodb_log_group_home_dir = <%= @innodb_log_group_home_dir %>
innodb_flush_log_at_trx_commit = <%= @innodb_flush_log_at_trx_commit %>
innodb_thread_concurrency = <%= @innodb_thread_concurrency %>
innodb_max_dirty_pages_pct = <%= @innodb_max_dirty_pages_pct %>
innodb_file_per_table = 1
innodb_io_capacity = <%= @innodb_io_capacity %>
innodb_commit_concurrency = <%= @innodb_commit_concurrency %>
innodb_data_file_path = <%= @innodb_data_file_path %>
innodb_log_files_in_group = <%= @innodb_log_files_in_group %>
<% unless @innodb_additional_mem_pool_size.nil? %>innodb_additional_mem_pool_size = <%= @innodb_additional_mem_pool_size %><% end %>
innodb_lock_wait_timeout = <%= @innodb_lock_wait_timeout %>
innodb_doublewrite = <%= @innodb_doublewrite %>
innodb_data_home_dir = <%= @innodb_data_home_dir %>
innodb_write_io_threads = <%= @innodb_write_io_threads %>
innodb_read_io_threads = <%= @innodb_read_io_threads %>
<% unless @innodb_stats_update_need_lock.nil? %>innodb_stats_update_need_lock = <%= @innodb_stats_update_need_lock %><% end %>
innodb_support_xa = <%= @innodb_support_xa %>
<% unless @innodb_flush_neighbor_pages.nil? %>innodb_flush_neighbor_pages = <%= @innodb_flush_neighbor_pages %><% end %>
<% unless @innodb_flush_neighbors.nil? %>innodb_flush_neighbors = <%= @innodb_flush_neighbors %><% end %>
<% unless @innodb_doublewrite_file.nil? %>innodb_doublewrite_file = <%= @innodb_doublewrite_file %><% end %>
<% if @have_innodb_buffer_pool_instances %>innodb_buffer_pool_instances = <%= [[ (@innodb_buffer_pool_size/1024/1024/1024).round, 1 ].max, 64 ].min %><% end %>
<% unless @innodb_print_all_deadlocks.nil? %>innodb_print_all_deadlocks = <%= @innodb_print_all_deadlocks %><% end %>
<% unless @innodb_purge_threads.nil? %>innodb_purge_threads = <%= @innodb_purge_threads %><% end %>
<% unless @innodb_buffer_pool_restore_at_startup.nil? %>
innodb_buffer_pool_restore_at_startup = <%= @innodb_buffer_pool_restore_at_startup %>
innodb_blocking_buffer_pool_restore = 1
<% end %>
<% unless @innodb_buffer_pool_load_at_startup.nil? %>innodb_buffer_pool_load_at_startup = <%= @innodb_buffer_pool_load_at_startup %><% end %>
<% unless @innodb_buffer_pool_dump_at_shutdown.nil? %>innodb_buffer_pool_dump_at_shutdown = <%= @innodb_buffer_pool_dump_at_shutdown %><% end %>
<% unless @innodb_buffer_pool_populate.nil? %>innodb_buffer_pool_populate = <%= @innodb_buffer_pool_populate %><% end %>
<% unless @innodb_stats_sample_pages.nil? %>innodb_stats_sample_pages = <%= @innodb_stats_sample_pages %><% end %>
<% unless @innodb_stats_on_metadata.empty? %>innodb_stats_on_metadata = <%= @innodb_stats_on_metadata %><% end %>
<% unless @innodb_strict_mode.empty? %>innodb_strict_mode = <%= @innodb_strict_mode %><% end %>
<% unless @innodb_defragment.nil? %>innodb_defragment = <%= @innodb_defragment %><% end %>

#--- sql ---#
sort_buffer_size = <%= @sort_buffer_size %>
key_buffer = <%= @key_buffer %>
sql_mode = <%= @sql_mode %>
read_buffer_size = <%= @read_buffer_size %>
query_cache_size = <%= @query_cache_size %>
query_cache_limit = <%= @query_cache_limit %>
query_cache_type = <%= @query_cache_type %>
thread_cache_size = <%= @thread_cache_size %>
join_buffer_size = <%= @join_buffer_size %>
read_rnd_buffer_size = <%= @read_rnd_buffer_size %>
<% unless @table_cache.nil? %>table_cache = <%= @table_cache %><% end %>
<% unless @table_open_cache.nil? %>table_open_cache = <%= @table_open_cache %><% end %>
<% unless @table_definition_cache.nil? %>table_definition_cache = <%= @table_definition_cache %><% end %>
auto_increment_increment = <%= @auto_increment_increment %>
auto_increment_offset = <%= @auto_increment_offset %>

<% unless @thread_handling.nil? %>thread_handling = <%= @thread_handling %><% end %>

#--- net ---#
bind-address = <%= @bind_address %>
port = <%= @port %>
socket = <%= @socket %>
connect_timeout = <%= @connect_timeout %>
interactive_timeout = <%= @interactive_timeout %>
wait_timeout = <%= @wait_timeout %>
max_connections = <%= @max_connections %>
max_user_connections = <%= @max_user_connections %>
max_allowed_packet = <%= @max_allowed_packet %>
max_connect_errors = <%= @max_connect_errors %>

#--- slave ---#
slave_net_timeout = <%= @slave_net_timeout %>
slave_compressed_protocol = <%= @slave_compressed_protocol %>
skip-slave-start = <%= @skip_slave_start %>
<% unless @slave_skip_errors.nil? %>slave-skip-errors = <%= @slave_skip_errors %><% end %>
<% unless @replicate_ignore_table.nil? %>
<% Array( @replicate_ignore_table ).each do |ignore_table| %>
replicate-ignore-table = <%= ignore_table %>
<% end %>
<% end %>
<% unless @replicate_wild_ignore_table.nil? %>
<% Array( @replicate_wild_ignore_table ).each do |wild_ignore_table| %>
replicate-wild-ignore-table = <%= wild_ignore_table %>
<% end %>
<% end %>

<% unless @sync_master_info.nil? %>sync_master_info = <%= @sync_master_info %><% end %>
<% unless @slave_parallel_threads.nil? %>slave_parallel_threads = <%= @slave_parallel_threads %><% end %>
<% unless @slave_parallel_mode.nil? %>slave_parallel_mode = <%= @slave_parallel_mode %><% end %>

#--- myisam ---#
concurrent_insert = <%= @concurrent_insert %>
myisam-recover = <%= @myisam_recover %>
myisam_sort_buffer_size = <%= @myisam_sort_buffer_size %>

#--- slowlog ---#
slow_query_log = <%= @slow_query_log %>
slow_query_log_file = <%= @slow_query_log_file %>
log_slow_rate_limit = <%= @log_slow_rate_limit %>
log-queries-not-using-indexes = <%= @log_queries_not_using_indexes %>
log_warnings = <%= @log_warnings %>
log_slow_verbosity = <%= @log_slow_verbosity %>
long_query_time = <%= @long_query_time %>

#--- binlog ---#
<% if @do_binlog %>
log_bin = <%= @log_bin %>
log_bin_index = <%= @log_bin_index %>
<% end %>
sync_binlog = <%= @sync_binlog %>
<% unless @binlog_format.nil? %>
binlog_format = <%= @binlog_format %>
<% end %>
max_binlog_size = <%= @max_binlog_size %>
expire_logs_days = <%= @expire_logs_days %>
log_slave_updates = <%= @log_slave_updates %>
<% unless @master_verify_checksum.nil? %>master_verify_checksum = <%= @master_verify_checksum ? 1 : 0 %><% end %>

#--- transaction ---#
transaction-isolation = <%= @transaction_isolation %>

#--- relaylog ---#
relay-log = <%= @relay_log %>
relay-log-info-file = <%= @relay_log_info_file %>
relay-log-index = <%= @relay_log_index %>
relay-log-space-limit = <%= @relay_log_space_limit %>
<% unless @sync_relay_log.nil? %>sync_relay_log = <%= @sync_relay_log %><% end %>
<% unless @sync_relay_log_info.nil? %>sync_relay_log_info = <%= @sync_relay_log_info %><% end %>

#--- errorlog ---#
log-error = <%= @log_error %>

