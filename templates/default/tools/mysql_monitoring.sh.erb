#!/bin/bash

###
# Generated by Chef for [<%= node[:fqdn] %>]
# Environment: <%= node.chef_environment %>
###

# monitoring script for mysql for <%= @name %>
#  creates status files in /tmp
#   - show status
#   - show slave status

MCLI="<%= @basedir %>/current/bin/mysql --no-defaults -u db_monitor -pdb_monitor -h 127.0.0.1 -P <%= @port %>"
MSTATUS="/tmp/mysql-monitoring-status-<%= @port %>"

# status
if timeout 3 $MCLI -e "show global status; show global variables; show slave status\G" > $MSTATUS.tmp ; then sleep 1; mv $MSTATUS.tmp $MSTATUS; else rm $MSTATUS.tmp; rm $MSTATUS; fi
